{"resourceType":"StructureDefinition","id":"97509562-0326-459e-a863-430574146520","url":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-CommunicationRequest","name":"NHSDigitalCommunicationRequest","status":"draft","fhirVersion":"4.0.1","mapping":[{"identity":"workflow","uri":"http://hl7.org/fhir/workflow","name":"Workflow Pattern"},{"identity":"rim","uri":"http://hl7.org/v3","name":"RIM Mapping"}],"kind":"resource","abstract":false,"type":"CommunicationRequest","baseDefinition":"http://hl7.org/fhir/StructureDefinition/CommunicationRequest","derivation":"constraint","differential":{"element":[{"id":"CommunicationRequest.status","path":"CommunicationRequest.status","mustSupport":true},{"id":"CommunicationRequest.medium","path":"CommunicationRequest.medium","binding":{"strength":"extensible","valueSet":"https://fhir.nhs.uk/ValueSet/Spine-CommunicationChannel-vs"}},{"id":"CommunicationRequest.subject","path":"CommunicationRequest.subject","definition":"The patient or group that is the focus of this communication request.\r\n\r\n```json\r\n\"subject\": {\r\n        \"type\": \"Patient\",\r\n        \"identifier\": {\r\n            \"system\": \"https://fhir.nhs.uk/Id/nhs-number\",\r\n            \"value\": \"9453740519\"\r\n        }\r\n    }\r\n```","type":[{"code":"Reference","targetProfile":["https://fhir.nhs.uk/StructureDefinition/NHSDigital-Patient"],"aggregation":["referenced"]}],"constraint":[{"key":"patient-reference","severity":"warning","human":"subject - An identifier reference or resource reference must be provided","expression":"(reference.exists() or (identifier.exists()))","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-CommunicationRequest"},{"key":"patient-nhs","severity":"error","human":"Supplied NHS Number is outside the English and Welsh NHS Number range or length of the number is wrong.","expression":"identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').exists().not() or (identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').exists()  and identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').value.matches('^([456789]{1}[0-9]{9})$'))","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-CommunicationRequest"}],"mustSupport":true},{"id":"CommunicationRequest.subject.identifier.system","path":"CommunicationRequest.subject.identifier.system","min":1},{"id":"CommunicationRequest.subject.identifier.value","path":"CommunicationRequest.subject.identifier.value","min":1},{"id":"CommunicationRequest.payload","path":"CommunicationRequest.payload","definition":"#### NHSApp\r\n\r\n**In App Messages** \r\n\r\nNHSApp supports a subset of Markdown for in-app messages, please see API documentation for more details. Only `contentString` is supported.\r\n\r\n```json\r\n  \r\n    \"payload\":  [\r\n        {\r\n            \"contentString\": \"You have a new appointment, please confirm you can attend. Open the Onboarded Third Party appointment [here](https://www.nhsapp.service.nhs.uk/appointments/hospital-appointments)\"\r\n        }\r\n    ]\r\n```\r\n\r\n**Push Notifications**\r\n\r\nOnly `contentReference` is supported and this should contain the URL to a page within the NHS App to be opened when the notification is tapped. If this property is not specified, the App will open on the home screen.\r\n\r\n```json\r\n  \r\n    \"payload\":  [\r\n        {\r\n            \"contentReference\": {\r\n                \"reference\": \"https://www.nhsapp.service.nhs.uk/patient/messages/app-messaging\",\r\n                \"display\": \"You have a new message. The message may contain something important.\"\r\n            }\r\n        }\r\n    ],\r\n```\r\n\r\n#### EPS\r\n\r\n**CommunicationRequest** is used in Electronic Prescription Service (EPS) to convey patient specific information. This includes:\r\n\r\n* patient information - messages to the patient\r\n* medications - list of authorised repeat medications which is contained on a FHIR List resource, details and example list of repeat medications can be found in profile `UKCore-List`\r\n\r\nThese would be traditionally printed on the right hand side of the FP10 stationery.\r\n\r\n**CommunicationRequest should not contain Clinical information regarding the prescriptions, these should be conveyed in the MedicationRequest resource.**\r\n\r\n```json\r\n\r\n    \"payload\":  [\r\n        {\r\n            \"contentString\": \"Please make an appointment to see your GP. Review date due\"\r\n        },\r\n        {\r\n            \"contentReference\": {\r\n                \"reference\": \"urn:uuid:d0f003a0-8763-43d5-a264-ce52a38901c9\",\r\n                \"display\": \"List of Repeat Medications for re-ordering\"\r\n            }\r\n        }\r\n    ],\r\n```","comment":"The payload will consist of message to the Patient and/or a reference to a list of active repeat medications.","min":1,"mustSupport":true},{"id":"CommunicationRequest.payload.extension","path":"CommunicationRequest.payload.extension","slicing":{"discriminator":[{"type":"value","path":"url"}],"rules":"open"},"min":0},{"id":"CommunicationRequest.payload.extension:deviceContent","path":"CommunicationRequest.payload.extension","sliceName":"deviceContent","min":0,"max":"1","type":[{"code":"Extension","profile":["https://fhir.nhs.uk/StructureDefinition/Extension-Spine-CommunicationPayload"]}]},{"id":"CommunicationRequest.requester","path":"CommunicationRequest.requester","definition":"The person/organisation making the communication request. This **SHOULD** use reference identifiers.\r\n\r\n```json\r\n\r\n    \"requester\": {\r\n        \"type\": \"Organization\",\r\n        \"identifier\": {\r\n            \"system\": \"https://fhir.nhs.uk/Id/ods-organization-code\",\r\n            \"value\": \"RBA\"\r\n        },\r\n        \"display\": \"TAUNTON AND SOMERSET NHS FOUNDATION TRUST\"\r\n    },\r\n```","min":1,"type":[{"code":"Reference","targetProfile":["https://fhir.nhs.uk/StructureDefinition/NHSDigital-Patient","https://fhir.nhs.uk/StructureDefinition/NHSDigital-PractitionerRole","https://fhir.nhs.uk/StructureDefinition/NHSDigital-Organization"],"aggregation":["referenced"]}],"mustSupport":true},{"id":"CommunicationRequest.requester.identifier.system","path":"CommunicationRequest.requester.identifier.system","min":1},{"id":"CommunicationRequest.requester.identifier.value","path":"CommunicationRequest.requester.identifier.value","min":1},{"id":"CommunicationRequest.recipient","path":"CommunicationRequest.recipient","definition":"The persons/organisations who will receive the communication request. This **SHOULD** use reference identifiers.\r\n\r\n```json\r\n\r\n    \"recipient\":  [\r\n        {\r\n            \"type\": \"Patient\",\r\n            \"identifier\": {\r\n                \"system\": \"https://fhir.nhs.uk/Id/nhs-number\",\r\n                \"value\": \"9453740519\"\r\n            }\r\n        }\r\n    ]\r\n```","min":1,"type":[{"code":"Reference","targetProfile":["http://hl7.org/fhir/StructureDefinition/Group","http://hl7.org/fhir/StructureDefinition/CareTeam","https://fhir.nhs.uk/StructureDefinition/NHSDigital-Organization","https://fhir.nhs.uk/StructureDefinition/NHSDigital-Patient","https://fhir.nhs.uk/StructureDefinition/NHSDigital-Practitioner","https://fhir.nhs.uk/StructureDefinition/NHSDigital-PractitionerRole","https://fhir.nhs.uk/StructureDefinition/NHSDigital-HealthcareService"],"aggregation":["referenced"]}],"mustSupport":true},{"id":"CommunicationRequest.recipient.identifier.system","path":"CommunicationRequest.recipient.identifier.system","min":1},{"id":"CommunicationRequest.recipient.identifier.value","path":"CommunicationRequest.recipient.identifier.value","min":1},{"id":"CommunicationRequest.sender.identifier.system","path":"CommunicationRequest.sender.identifier.system","min":1},{"id":"CommunicationRequest.sender.identifier.value","path":"CommunicationRequest.sender.identifier.value","min":1},{"id":"CommunicationRequest.reasonCode","path":"CommunicationRequest.reasonCode","binding":{"strength":"preferred","description":"UKCore event types","valueSet":"https://fhir.nhs.uk/ValueSet/NHSDigital-message-events"}},{"id":"CommunicationRequest.reasonCode.coding.system","path":"CommunicationRequest.reasonCode.coding.system","min":1},{"id":"CommunicationRequest.reasonCode.coding.code","path":"CommunicationRequest.reasonCode.coding.code","min":1},{"id":"CommunicationRequest.reasonCode.coding.display","path":"CommunicationRequest.reasonCode.coding.display","min":1}]}}