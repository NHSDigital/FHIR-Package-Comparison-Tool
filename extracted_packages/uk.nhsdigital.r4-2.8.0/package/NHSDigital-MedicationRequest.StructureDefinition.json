{"resourceType":"StructureDefinition","id":"db5e6fcc-2f29-42a8-ab29-18faa469d032","url":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest","name":"NHSDigitalMedicationRequest","status":"draft","fhirVersion":"4.0.1","kind":"resource","abstract":false,"type":"MedicationRequest","baseDefinition":"https://fhir.hl7.org.uk/StructureDefinition/UKCore-MedicationRequest","derivation":"constraint","differential":{"element":[{"id":"MedicationRequest","path":"MedicationRequest","constraint":[{"key":"eps-1","severity":"error","human":"medication[x] - Only one of medicationReference or medicationCodeableConcept should be provided","expression":"(medicationReference.exists() and medicationCodeableConcept.exists().not()) or (medicationReference.exists().not() and medicationCodeableConcept.exists())","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"},{"key":"eps-5","severity":"error","human":"Extension(responsiblePractitioner) - An identifier or resource reference must be provided","expression":"extension('https://fhir.nhs.uk/StructureDefinition/Extension-DM-ResponsiblePractitioner').exists().not() or (extension('https://fhir.nhs.uk/StructureDefinition/Extension-DM-ResponsiblePractitioner').value.reference.exists() or extension('https://fhir.nhs.uk/StructureDefinition/Extension-DM-ResponsiblePractitioner').value.system.exists())","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"},{"key":"eps-6","severity":"error","human":"Extension repeatInformation is required for continuous and continuous-repeat-dispensing MedicationRequests. It is not required for actue MedicationRequests","expression":"(courseOfTherapyType.coding.code.startsWith('acute') and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').exists().not()) or  ((courseOfTherapyType.coding.code.startsWith('continuous')) and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').exists())","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"},{"key":"eps-7","severity":"warning","human":"For continuous-repeat-dispensing intent must be reflex-order or original-order","expression":"(courseOfTherapyType.coding.code != 'continuous-repeat-dispensing') or ((courseOfTherapyType.coding.code = 'continuous-repeat-dispensing') and ((intent ='original-order') or (intent ='reflex-order')))","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"},{"key":"eps-8","severity":"error","human":"For continuous intent must be instance-order or original-order","expression":"(courseOfTherapyType.coding.code != 'continuous') or ((courseOfTherapyType.coding.code = 'continuous') and ((intent ='original-order') or (intent ='instance-order')))","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"},{"key":"eps-9","severity":"warning","human":"dispenseRequest.numberOfRepeatsAllowed should be populated for continuous and continuous-repeat-dispensing MedicationRequests.","expression":"(courseOfTherapyType.coding.code.startsWith('acute')) or  (courseOfTherapyType.coding.code.startsWith('continuous') and dispenseRequest.exists() and dispenseRequest.numberOfRepeatsAllowed.exists())","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"},{"key":"eps-10","severity":"error","human":"For continuous-repeat-dispensing (intent=reflex-order) basedOn must be populated","expression":"(courseOfTherapyType.coding.code = 'acute') or (courseOfTherapyType.coding.code = 'continuous') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent !='reflex-order') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent ='reflex-order' and dispenseRequest.exists() and basedOn.exists())","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"},{"key":"eps-11","severity":"error","human":"For continuous-repeat-dispensing (intent=reflex-order) or continous orders, numberOfRepeatsAllowed must be empty or equal to 0","expression":"(courseOfTherapyType.coding.code = 'acute') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent !='reflex-order') or ((courseOfTherapyType.coding.code = 'continuous' or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent ='reflex-order')) and (dispenseRequest.numberOfRepeatsAllowed.exists().not() or (dispenseRequest.numberOfRepeatsAllowed.exists() and dispenseRequest.numberOfRepeatsAllowed = 0)))","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"},{"key":"eps-12","severity":"warning","human":"For continuous issues basedOn should be populated","expression":"(courseOfTherapyType.coding.code = 'acute') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing') or (courseOfTherapyType.coding.code = 'continuous' and dispenseRequest.exists() and basedOn.exists())","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"},{"key":"eps-13","severity":"error","human":"Extension repeatInformation.numberOfPrescriptionsIssued should not be present for continuous-repeat-dispensing that are not intent=reflex-order","expression":"(courseOfTherapyType.coding.code != 'continuous-repeat-dispensing') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent='reflex-order') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent!='reflex-order' and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').exists() and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').extension('numberOfPrescriptionsIssued').exists().not())","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"},{"key":"eps-14","severity":"error","human":"Extension repeatInformation.numberOfPrescriptionsIssued should be present for continuous-repeat-dispensing that have intent=reflex-order","expression":"(courseOfTherapyType.coding.code != 'continuous-repeat-dispensing') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent != 'reflex-order') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent='reflex-order' and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').exists() and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').extension('numberOfPrescriptionsIssued').exists())","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"},{"key":"eps-15","severity":"warning","human":"Extension repeatInformation.numberOfPrescriptionsIssued is recommend to be present for continuous issues","expression":"(courseOfTherapyType.coding.code != 'continuous') or (courseOfTherapyType.coding.code = 'continuous' and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').exists() and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').extension('numberOfPrescriptionsIssued').exists())","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"},{"key":"eps-16","severity":"error","human":"Extension repeatInformation.numberOfPrescriptionsIssued should not be present for acute issues","expression":"(courseOfTherapyType.coding.code != 'acute') or (courseOfTherapyType.coding.code = 'acute' and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').exists().not())","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"}]},{"id":"MedicationRequest.extension","path":"MedicationRequest.extension","slicing":{"discriminator":[{"type":"value","path":"url"}],"rules":"open"},"min":1},{"id":"MedicationRequest.extension:medicationRepeatInformation","path":"MedicationRequest.extension","sliceName":"medicationRepeatInformation","short":"Continous and Continuous Repeat Dispensing","definition":"This extension <b>MUST</b> be present for  `continuous` and `continuous-repeat-dispensing` therapy types. \r\n\r\n| Field | Description |\r\n|---|---|\r\n| numberOfPrescriptionsIssued |  Running total of number of issues made against a repeat authorisation. Including this issue.   |\r\n| ~~numberOfRepeatPrescriptionsAllowed~~ | Retired. See <a href=\"#numberOfRepeatsAllowed\">numberOfRepeatsAllowed</a> | \r\n| authorisationExpiryDate | The date a repeat prescription authorisation will expire. |\r\n\r\n```json\r\n\"extension\": [\r\n  {\r\n       \"url\": \"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation\",\r\n       \"extension\": [\r\n           {\r\n               \"url\": \"numberOfPrescriptionsIssued\",\r\n               \"valueUnsignedInt\": 3\r\n           },\r\n           {\r\n               \"url\": \"authorisationExpiryDate\",\r\n               \"valueDateTime\": \"2020-08-07\"\r\n           }\r\n       ]\r\n   }\r\n]\r\n```","min":0,"mustSupport":true},{"id":"MedicationRequest.extension:responsiblePractitioner","path":"MedicationRequest.extension","sliceName":"responsiblePractitioner","short":"Responsible Practitioner for the prescription","definition":"Must only be populated if the  `requester` can not be responsible for the prescription, i.e. they would not be named as the prescriber on the FP10.\r\n\r\n```json\r\n\"extension\": [\r\n        \r\n    {\r\n        \"url\": \"https://fhir.nhs.uk/StructureDefinition/Extension-DM-ResponsiblePractitioner\",\r\n        \"valueReference\": {\r\n            \"reference\": \"urn:uuid:a5acefc1-f8ca-4989-a5ac-34ae36741466\",\r\n            \"display\": \"DR SAZ RAZ\"\r\n        }\r\n    }\r\n],\r\n```","min":0,"max":"1","type":[{"code":"Extension","profile":["https://fhir.nhs.uk/StructureDefinition/Extension-DM-ResponsiblePractitioner"]}],"mustSupport":true},{"id":"MedicationRequest.extension:prescriptionEndorsement","path":"MedicationRequest.extension","sliceName":"prescriptionEndorsement","short":"NHS BSA Prescription Endorsements","definition":"The codes are contained in the valueset\r\n\r\n| Code | Display |\r\n|---|---|\r\n| CC |  Contraceptive |\r\n| FS |  Sexual Health| \r\n| ACBS |  Advisory Committee on Borderline Substances. Part XV Drug Tariff | \r\n| SLS |  Selected List Scheme. Part XVIIIB Drug Tariff | \r\n| AF |  Food replacement/food supplement products|\r\n\r\n```json\r\n\"resourceType\": \"MedicationRequest\",\r\n    \"extension\":  [\r\n      {\r\n          \"url\": \"https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionEndorsement\",\r\n          \"valueCodeableConcept\": {\r\n              \"coding\":  [\r\n                {\r\n                    \"system\": \"https://fhir.nhs.uk/CodeSystem/medicationrequest-endorsement\",\r\n                    \"code\": \"SLS\",\r\n                    \"display\": \"Selected List Scheme\"\r\n                }\r\n            ]\r\n        }\r\n    }\r\n  ],\r\n```","min":0,"type":[{"code":"Extension","profile":["https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionEndorsement"]}],"mustSupport":true},{"id":"MedicationRequest.extension:prescriptionTaskStatusReason","path":"MedicationRequest.extension","sliceName":"prescriptionTaskStatusReason","short":"Prescription task status reason","definition":"The status history within EPS is primarily a technical Status and the statusReason will reflect current clinical status of the order.","min":0,"type":[{"code":"Extension","profile":["https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionStatusHistory"]}],"mustSupport":true},{"id":"MedicationRequest.extension:NHSBSAprescriptionType","path":"MedicationRequest.extension","sliceName":"NHSBSAprescriptionType","short":"NHS BSA Prescription Type","definition":"The vocabulary for the ‘PrescriptionType’ vocabulary is defined within the NHSBSA Overprint Specification. \r\n\r\nThe System must populate the ‘PrescriptionType’ attribute for the appropriate combination of prescriber and care setting. Retired codes within this vocabulary must not be used\r\n\r\n```json\r\n\"extension\":  [\r\n    {\r\n        \"url\": \"https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionType\",\r\n        \"valueCoding\": {\r\n            \"system\": \"https://fhir.nhs.uk/CodeSystem/prescription-type\",\r\n            \"code\": \"1201\",\r\n            \"display\": \"Outpatient Homecare Prescriber - Medical Prescriber\"\r\n        }\r\n    }\r\n    ]\r\n```","min":1,"type":[{"code":"Extension","profile":["https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionType"]}],"mustSupport":true},{"id":"MedicationRequest.extension:controlledDrug","path":"MedicationRequest.extension","sliceName":"controlledDrug","short":"Optional Controlled Drug Extensions","definition":"The table below summarises the EPS requirements for the CD schedules. The terms “Hand signature” and “Electronic signature” expressed in the table are shortened references to the legal definition of signature requirements within government legislation.\r\n\r\n| Sch. | Code | Signing Legal Requirement | EPS Scope | Expiry Date | Quantity Representation | Repeat Dispensing Allowed | RD 1st Issue Expiry | RD Subsequent Expiry |\r\n|---|---|---|---|---|---|---|---|---|\r\n| 1 | CD1 | Invalid to prescribe | Out of scope | N/A | N/A | N/A | N/A ||\r\n| 2 | CD2 | Hand signature or electronic signature | In scope | 28 days | Words and Figures | No | N/A | N/A ||\r\n| 3 | CD3 | Hand signature or electronic signature | In scope | 28 days | Words and Figures | No | N/A | N/A ||\r\n| 4 | CD4-1 CD4-2 | Hand signature or electronic signature | In scope | 28 days | Figures | Yes | 28 days | Up to 12 months |\r\n| 5 | CD5 | Hand signature or electronic signature | In scope | 6 Months | Figures | Yes | 6 months | Up to 12 months |\r\n\r\nIt is a legal requirement to state the prescribed quantity as words in the `quantityWords`\r\n\r\n```json\r\n{\r\n    \"url\": \"https://fhir.nhs.uk/StructureDefinition/Extension-DM-ControlledDrug\",\r\n    \"extension\": [\r\n        {\r\n            \"url\": \"quantityWords\",\r\n            \"valueString\": \"twenty eight\"\r\n        },\r\n        {\r\n            \"url\": \"schedule\",\r\n            \"valueCoding\": {\r\n                \"system\": \"https://fhir.nhs.uk/CodeSystem/medicationrequest-controlled-drug\",\r\n                \"code\": \"CD2\",\r\n                \"display\": \"Schedule 2\"\r\n            }\r\n        }\r\n    ]\r\n}\r\n```","min":0,"max":"1","type":[{"code":"Extension","profile":["https://fhir.nhs.uk/StructureDefinition/Extension-DM-ControlledDrug"]}],"mustSupport":true},{"id":"MedicationRequest.extension:dispensingInformation","path":"MedicationRequest.extension","sliceName":"dispensingInformation","short":"For EPS use only","definition":"This extension is used in `continuous-repeat-dispensing` prescriptions sent by EPS to dispensing systems to convey information on prior dispensed medications.\r\n\r\n\r\n```json\r\n\"extension\":  [\r\n                {\r\n                    \"url\": \"https://fhir.nhs.uk/StructureDefinition/Extension-EPS-DispensingInformation\",\r\n                    \"extension\":  [\r\n                        {\r\n                            \"url\": \"dispenseStatus\",\r\n                            \"valueCoding\": {\r\n                                \"system\": \"https://fhir.nhs.uk/CodeSystem/medicationdispense-type\",\r\n                                \"code\": \"0001\",\r\n                                \"display\": \"Item fully dispensed\"\r\n                            }\r\n                        },\r\n                        {\r\n                            \"url\": \"dateLastDispensed\",\r\n                            \"valueDateTime\": \"2018-04-22T09:57:03+00:00\"\r\n                        }\r\n                    ]\r\n                }\r\n            ],\r\n```","min":0,"max":"1","type":[{"code":"Extension","profile":["https://fhir.nhs.uk/StructureDefinition/Extension-EPS-DispensingInformation"]}],"mustSupport":true},{"id":"MedicationRequest.identifier","path":"MedicationRequest.identifier","slicing":{"discriminator":[{"type":"value","path":"system"}],"rules":"open"},"short":"Each MedicationRequest MUST be identified by an Universal Unique Identifiers (UUIDs) with a system of https://fhir.nhs.uk/Id/prescription-order-item-number","definition":"UUID example (for illustration purposes only);\r\n\r\na54219b8-f741-4c47-b662-e4f8dfa49ab6\r\n\r\n```json\r\n \"identifier\":  [\r\n    {\r\n        \"system\": \"https://fhir.nhs.uk/Id/prescription-order-item-number\",\r\n        \"value\": \"a54219b8-f741-4c47-b662-e4f8dfa49ab6\"\r\n    }\r\n]\r\n```","min":1,"mustSupport":true},{"id":"MedicationRequest.identifier:prescriptionOrderItem","path":"MedicationRequest.identifier","sliceName":"prescriptionOrderItem","short":"Prescription Order Item","definition":"Unique Id of the MedicationRequest within EPS","min":1,"max":"1"},{"id":"MedicationRequest.identifier:prescriptionOrderItem.system","path":"MedicationRequest.identifier.system","min":1,"fixedUri":"https://fhir.nhs.uk/Id/prescription-order-item-number"},{"id":"MedicationRequest.identifier:prescriptionOrderItem.value","path":"MedicationRequest.identifier.value","min":1},{"id":"MedicationRequest.status","path":"MedicationRequest.status","short":"active | cancelled | stopped","definition":"A code specifying the current state of the order. Generally, this will be active or completed state. \r\n\r\n| code | Definition |\r\n|--|--|\r\n| active | The prescription is 'actionable', but not all actions that are implied by it have occurred yet. It has not been dispensed or filled. |\r\n| cancelled | The prescription is to be cancelled or it has been cancelled been withdrawn before any administrations have occurred. Prescriptions in the process of being cancelled will be regarded as active until all actions are complete. |\r\n| stopped | Actions implied by the prescription are to be permanently halted, before all of the administrations occurred. This should not be used if the original order was entered in error|\r\n|completed|All actions that are implied by the prescription have occurred.|\r\n\r\n\r\n### Logical medicationRequest status transitions\r\n\r\nThis state transition diagram is an enhancement over the generic State Machine defined within the FHIR specification. It includes the status values associated with a medication request with transitions applicable to a UK implementation.\r\n\r\n<img src=\"https://github.com/NHSDigital/NHSDigital-FHIR-ImplementationGuide/blob/master/Diagams/medication-request-status-flow.png?raw=true\" width=\"100%\" hieght=\"auto\"/>","mustSupport":true},{"id":"MedicationRequest.statusReason","path":"MedicationRequest.statusReason","definition":"This is generally only used for exception statuses such as `suspended` or `cancelled`. It is the clinical status reason for the cancellation.\r\n\r\nThis is mandatory for 'prescription-order-update' messages.\r\n\r\n```json\r\n\"statusReason\": {\r\n    \"coding\": [\r\n        {\r\n            \"system\": \"https://fhir.nhs.uk/CodeSystem/medicationrequest-status-reason\",\r\n            \"code\": \"0001\",\r\n            \"display\": \"Prescribing Error\"\r\n        }\r\n    ]\r\n},\r\n```","mustSupport":true,"binding":{"strength":"required","valueSet":"https://fhir.nhs.uk/ValueSet/DM-medicationrequest-status-reason"}},{"id":"MedicationRequest.statusReason.coding","path":"MedicationRequest.statusReason.coding","min":1,"max":"1"},{"id":"MedicationRequest.statusReason.coding.system","path":"MedicationRequest.statusReason.coding.system","min":1},{"id":"MedicationRequest.statusReason.coding.code","path":"MedicationRequest.statusReason.coding.code","min":1},{"id":"MedicationRequest.statusReason.coding.display","path":"MedicationRequest.statusReason.coding.display","min":1},{"id":"MedicationRequest.intent","path":"MedicationRequest.intent","comment":"Indicates the type of order. A code specifying the current state of the order. Generally, this will be active or completed state. \r\n\r\n| code | display | courseOfTherapyType | Definition |\r\n|---|---|\r\n| order | Order | acute | The request represents a request/demand and authorization for action |\r\n| original-order | Original Order | continuous-repeat-dispensing continuous | The request represents the original authorization for the medication request. |\r\n| reflex-order |Reflex Order | continuous-repeat-dispensing | The request represents an automatically generated supplemental authorization (by EPS) for action based on a parent authorization together with initial results of the action taken against that parent authorization. |\r\n| instance-order | Instance Order | continuous | The request represents an instance for the particular order. |"},{"id":"MedicationRequest.category","path":"MedicationRequest.category","definition":"In primary care the code of `community` should be used. In secondary care the category will often match the Episode/Spell type.\r\n\r\n| Code | System | Display |\r\n|---|---|\r\n| leave | https://fhir.nhs.uk/CodeSystem/medicationrequest-category | Leave |\r\n|outpatient | http://terminology.hl7.org/CodeSystem/medicationrequest-category |Outpatient |\r\n| discharge | http://terminology.hl7.org/CodeSystem/medicationrequest-category | Discharge |\r\n| community |http://terminology.hl7.org/CodeSystem/medicationrequest-category | Community |\r\n| inpatient  |http://terminology.hl7.org/CodeSystem/medicationrequest-category | Inpatient |\r\n\r\n```json\r\n\"category\": [\r\n    {\r\n        \"coding\": [\r\n            {\r\n                \"system\": \"http://terminology.hl7.org/CodeSystem/medicationrequest-category\",\r\n                \"code\": \"outpatient\",\r\n                \"display\": \"Outpatient\"\r\n            }\r\n        ]\r\n    }\r\n],\r\n```","min":1,"mustSupport":true},{"id":"MedicationRequest.category.coding","path":"MedicationRequest.category.coding","slicing":{"discriminator":[{"type":"value","path":"system"}],"rules":"open"},"min":1,"max":"1"},{"id":"MedicationRequest.category.coding:patientClassFHIR","path":"MedicationRequest.category.coding","sliceName":"patientClassFHIR","max":"1","binding":{"strength":"required","valueSet":"https://fhir.nhs.uk/ValueSet/DM-medicationrequest-category"}},{"id":"MedicationRequest.category.coding:patientClassFHIR.system","path":"MedicationRequest.category.coding.system","min":1,"fixedUri":"http://terminology.hl7.org/CodeSystem/medicationrequest-category"},{"id":"MedicationRequest.category.coding:patientClassFHIR.code","path":"MedicationRequest.category.coding.code","min":1},{"id":"MedicationRequest.category.coding:patientClassUK","path":"MedicationRequest.category.coding","sliceName":"patientClassUK","max":"1","binding":{"strength":"required","valueSet":"https://fhir.nhs.uk/ValueSet/DM-medicationrequest-category"}},{"id":"MedicationRequest.category.coding:patientClassUK.system","path":"MedicationRequest.category.coding.system","min":1,"fixedUri":"https://fhir.nhs.uk/CodeSystem/medicationrequest-category"},{"id":"MedicationRequest.category.coding:patientClassUK.code","path":"MedicationRequest.category.coding.code","min":1},{"id":"MedicationRequest.medication[x]","path":"MedicationRequest.medication[x]","definition":"Only Virtual Medical Products (VMP) and Actual Medical Products (AMP) can be used.","comment":"Any code from the SnomedCT UK DMD subset for VMP, AMP and VTM concepts\r\n\r\n<table>\r\n<thead>\r\n<th data-no-sort width=\"25%\">\r\ndm+d Category\r\n</th>\r\n<th data-no-sort width=\"50%\">\r\ndm+d Description\r\n</th>\r\n<th data-no-sort width=\"25%\">\r\nUK SNOMED Members Of\r\n</th>\r\n\r\n</thead>\r\n<tr>\r\n<td>\r\nVMP\r\n</td>\r\n<td>\r\nVirtual Medical Product\r\n</td>\r\n<td>\r\n<a href=\"https://termbrowser.nhs.uk/?perspective=full&conceptId1=999000561000001109\" target=\"_blank\">999000561000001109</a>\r\n</td>\r\n</tr>\r\n<tr>\r\n<td>\r\nAMP\r\n</td>\r\n<td>\r\nActual Medical Product\r\n</td>\r\n<td>\r\n<a href=\"https://termbrowser.nhs.uk/?perspective=full&conceptId1=999000541000001108\" target=\"_blank\">999000541000001108</a>\r\n</td>\r\n</tr>\r\n</table>","type":[{"code":"CodeableConcept","profile":["https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest-CodeableConcept"]},{"code":"Reference","targetProfile":["https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest-Medication"],"aggregation":["bundled"]}],"mustSupport":true,"binding":{"strength":"extensible","valueSet":"https://fhir.nhs.uk/ValueSet/NHSDigital-MedicationCode"}},{"id":"MedicationRequest.subject","path":"MedicationRequest.subject","definition":"A resource reference to a Patient with a traced NHS Number is required, an untraced NHS Number **MUST NOT** be used.\r\n\r\n```json\r\n \"subject\": {\r\n                    \"type\": \"Patient\",\r\n                    \"reference\": \"urn:uuid:bde9eba6-079f-4210-8108-6ea8db58de8c\",\r\n                    \"display\": \"Miss Bernie Kanfeld\"\r\n                }\r\n```","type":[{"code":"Reference","targetProfile":["https://fhir.nhs.uk/StructureDefinition/NHSDigital-Patient-PDS"]}],"constraint":[{"key":"patient-nhs","severity":"error","human":"Supplied NHS Number is outside the English and Welsh NHS Number range or length of the number is wrong.","expression":"identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').exists().not() or (identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').exists()  and identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').value.matches('^([456789]{1}[0-9]{9})$'))","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-Claim"}],"mustSupport":true},{"id":"MedicationRequest.subject.reference","path":"MedicationRequest.subject.reference","min":1},{"id":"MedicationRequest.subject.identifier.system","path":"MedicationRequest.subject.identifier.system","min":1,"fixedUri":"https://fhir.nhs.uk/Id/nhs-number"},{"id":"MedicationRequest.subject.identifier.value","path":"MedicationRequest.subject.identifier.value","min":1},{"id":"MedicationRequest.encounter","path":"MedicationRequest.encounter","definition":"Encounter is required for secondary care prescriptions.","type":[{"code":"Reference","targetProfile":["https://fhir.nhs.uk/StructureDefinition/NHSDigital-Encounter"]}]},{"id":"MedicationRequest.authoredOn","path":"MedicationRequest.authoredOn","min":1,"mustSupport":true},{"id":"MedicationRequest.requester","path":"MedicationRequest.requester","definition":"The requester must contain a resource reference to the Practitioner who has electronically signed the prescription.\r\n\r\nIf the `requester` can not take responsibility for the prescription, i.e. they would not be the prescriber on the FP10. Then the **extension responsiblePractitioner** must be populated.\r\n\r\n```json\r\n\"requester\": {\r\n    \"reference\": \"urn:uuid:56166769-c1c4-4d07-afa8-132b5dfca666\"\r\n},\r\n```","min":1,"type":[{"code":"Reference","targetProfile":["https://fhir.nhs.uk/StructureDefinition/NHSDigital-PractitionerRole-EPSLegal","https://fhir.nhs.uk/StructureDefinition/NHSDigital-PractitionerRole-SDS"]}],"constraint":[{"key":"eps-3","severity":"error","human":"requester - An identifier reference or resource reference must be provided","expression":"(reference.exists() or (identifier.exists()))","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"}],"mustSupport":true},{"id":"MedicationRequest.requester.reference","path":"MedicationRequest.requester.reference","min":1},{"id":"MedicationRequest.performer","path":"MedicationRequest.performer","type":[{"code":"Reference","profile":["https://fhir.nhs.uk/StructureDefinition/NHSDigital-Reference"]}]},{"id":"MedicationRequest.recorder","path":"MedicationRequest.recorder","type":[{"code":"Reference","targetProfile":["https://fhir.nhs.uk/StructureDefinition/NHSDigital-Practitioner"]}],"constraint":[{"key":"eps-4","severity":"error","human":"recorder - An identifier reference or resource reference must be provided","expression":"(reference.exists() or (identifier.exists()))","source":"https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"}]},{"id":"MedicationRequest.basedOn","path":"MedicationRequest.basedOn","definition":"This MUST be populated for `continuous-repeat-dispensing` issues where intent=`reflex-order`, i.e. the issues sent from EPS to pharmacists.\r\nIt is recommended this is populated for `continuous` issues and this should reference the original order.\r\n\r\nExample for a `reflex-order` (continuous-repeat-dispensing): \r\n\r\n```json\r\n \"basedOn\": [\r\n        {\r\n            \"extension\": [\r\n                {\r\n                    \"url\": \"https://fhir.nhs.uk/StructureDefinition/Extension-EPS-RepeatInformation\",\r\n                    \"extension\": [\r\n                        {\r\n                            \"url\": \"numberOfRepeatsAllowed\",\r\n                            \"valueInteger\": 6\r\n                        }\r\n                    ]\r\n                }\r\n            ],\r\n            \"identifier\": {\r\n                \"system\": \"https://fhir.nhs.uk/Id/prescription-order-item-number\",\r\n                \"value\": \"A7B86F8D-1D59-FC28-E050-D20AE3A215F0\"\r\n            }\r\n        }\r\n    ]\r\n```\r\n\r\nExample for a `instance-order` (continuous). Note this references an example MedicationRequest from GP Connect:\r\n\r\n```json\r\n \"basedOn\": [\r\n        {\r\n            \"extension\": [\r\n                {\r\n                    \"url\": \"https://fhir.nhs.uk/StructureDefinition/Extension-EPS-RepeatInformation\",\r\n                    \"extension\": [\r\n                        {\r\n                            \"url\": \"numberOfRepeatsAllowed\",\r\n                            \"valueInteger\": 5\r\n                        }\r\n                    ]\r\n                }\r\n            ],\r\n            \"identifier\": {\r\n                \"system\": \"https://provider.nhs.uk/data-identifier\",\r\n                \"value\": \"53426283749629\"\r\n            }\r\n        }\r\n    ]\r\n```","type":[{"code":"Reference","targetProfile":["http://hl7.org/fhir/StructureDefinition/ImmunizationRecommendation","https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"]}],"mustSupport":true},{"id":"MedicationRequest.basedOn.extension","path":"MedicationRequest.basedOn.extension","slicing":{"discriminator":[{"type":"value","path":"url"}],"rules":"open"},"min":0},{"id":"MedicationRequest.basedOn.extension:repeatInformation","path":"MedicationRequest.basedOn.extension","sliceName":"repeatInformation","short":"Additional repeatInformation","definition":"The extension `numberOfRepeatsIssued` should not be populated.\r\n\r\nThe meaning of `numberOfRepeatsAllowed` is the same as the dispensingRequest.numberOfRepeatsAllowed i.e. \r\n\r\nAn integer indicating the number of times, in addition to the original dispense, (aka refills or repeats) that the patient can receive the prescribed medication. Usage Notes: This integer does not include the original order dispense. This means that if an order indicates dispense 30 tablets plus \"3 repeats\", then the order can be dispensed a total of 4 times and the patient can receive a total of 120 tablets. A prescriber may explicitly say that zero refills are permitted after the initial dispense.\r\n\r\n```json\r\n\"extension\": [\r\n                {\r\n                    \"url\": \"https://fhir.nhs.uk/StructureDefinition/Extension-EPS-RepeatInformation\",\r\n                    \"extension\": [\r\n                        {\r\n                            \"url\": \"numberOfRepeatsAllowed\",\r\n                            \"valueInteger\": 2\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n```","min":0,"max":"1","type":[{"code":"Extension","profile":["https://fhir.nhs.uk/StructureDefinition/Extension-EPS-RepeatInformation"]}],"mustSupport":true},{"id":"MedicationRequest.basedOn.extension:orignalPrescriptionId","path":"MedicationRequest.basedOn.extension","sliceName":"orignalPrescriptionId","definition":"The original prescription id, used in repeats. This is taken from the same extension in the original MedicationRequest.groupIdentifier.\r\n```json\r\n  \"extension\":  [\r\n        {\r\n            \"url\": \"https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionId\",\r\n            \"valueIdentifier\": {\r\n                \"system\": \"https://fhir.nhs.uk/Id/prescription\",\r\n                \"value\": \"ad945a29-85f8-439a-b590-6789719adc16\"\r\n            }\r\n        }\r\n    ],\r\n```","min":0,"type":[{"code":"Extension","profile":["https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionId"]}],"isModifier":false},{"id":"MedicationRequest.groupIdentifier","path":"MedicationRequest.groupIdentifier","short":"groupIdentifier (Short Form Prescription ID)","definition":"The purpose of the Short Form Prescription ID is to identify the prescription during its lifecycle within the Spine (i.e. prescribe, dispense & claim). The prescription UUID is retained to provide the link through to the Spine medication record within the PSIS and must be included as the first identifier within the prescription message.\r\nThe format of the Short Form Prescription ID is as follows;\r\n\r\n`<RandomNumber>-<PracticeODSCode/ClinicODSCode>-<PracticeSequence/ClinicSequence><CheckDigit>`\r\n\r\nWhere;\r\n\r\n`<RandomNumber>` is a locally generated random number each time a Prescription ID is generated of length 6 hexadecimal characters.\r\n\r\n`<PracticeODSCode/ClinicODSCode>` is the unique ODS code for the practice or clinic code (aka cost centre) as defined within the Spine SDS of length 6 characters. Where the prescriber ODS code is shorter than 6 characters it must be zero-padded up to six characters from the start of the ODS code, e.g. “0A1B2C”.\r\n\r\n`<PracticeSequence/ClinicSequence>` is an incremental sequence number starting from 00000 that is reset after FFFFF back to zero of length 5 hexadecimal characters. For systems that support multiple practices or clinics, a sequence number per practice/clinic is required. This is to ensure uniqueness of prescriptions within the Spine EPS component during the prescription lifecycle.\r\n\r\n`<CheckDigit>` is calculated on the entire ID using the ISO/IEC 7064:2003 MOD 37-2 standard. The check digit algorithm is identical to that using for EPS Release 1.\r\n\r\nNote. Hyphens are always included to separate the ID into 3 blocks of 6 characters.\r\n\r\nNote. The implementation of the MOD 37-2 standard uses a “+” character for char 36 opposed to a “*” character.\r\n\r\nShort Form Prescription ID example (for illustration purposes only);\r\n\r\n**83C40E-A23856-00123W**\r\n\r\n```json\r\n\"groupIdentifier\": {\r\n    ...\r\n    \"system\": \"https://fhir.nhs.uk/Id/prescription-order-number\",\r\n    \"value\": \"DC2C66-A1B2C3-23407B\"\r\n},\r\n```","comment":"ITK HL7v3 Mapping = The groupIdentifier is equivalent to ParentPrescription.id (prescription-order-number). The extension is used to carry the ParentPrescription.id (UUID).","min":1,"mustSupport":true},{"id":"MedicationRequest.groupIdentifier.extension","path":"MedicationRequest.groupIdentifier.extension","slicing":{"discriminator":[{"type":"value","path":"url"}],"rules":"open"},"min":1},{"id":"MedicationRequest.groupIdentifier.extension:PrescriptionOrderUUID","path":"MedicationRequest.groupIdentifier.extension","sliceName":"PrescriptionOrderUUID","short":"UUID order number for grouped MedciationRequests","definition":"When UUIDs are used within HL7 messages they must be represented in an upper case human-readable hexadecimal format where hyphen separators are used as per the example below and as defined by the ‘datatype’ schema within the DMS.\r\n\r\nUUID example (for illustration purposes only);\r\n\r\n**34026084-A445-84AD-2D01-97D69ED25865**\r\n\r\n```json\r\n\"groupIdentifier\": {\r\n    \"extension\":  [\r\n        {\r\n            \"url\": \"https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionId\",\r\n            \"valueIdentifier\": {\r\n                \"system\": \"https://fhir.nhs.uk/Id/prescription\",\r\n                \"value\": \"ad945a29-85f8-439a-b590-6789719adc16\"\r\n            }\r\n        }\r\n    ],\r\n    \"system\": \"https://fhir.nhs.uk/Id/prescription-order-number\",\r\n    \"value\": \"DC2C66-A1B2C3-23407B\"\r\n},\r\n```","min":1,"type":[{"code":"Extension","profile":["https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionId"]}]},{"id":"MedicationRequest.groupIdentifier.extension:PrescriptionOrderUUID.value[x].system","path":"MedicationRequest.groupIdentifier.extension.value[x].system","min":1},{"id":"MedicationRequest.groupIdentifier.extension:PrescriptionOrderUUID.value[x].value","path":"MedicationRequest.groupIdentifier.extension.value[x].value","min":1},{"id":"MedicationRequest.groupIdentifier.system","path":"MedicationRequest.groupIdentifier.system","min":1,"fixedUri":"https://fhir.nhs.uk/Id/prescription-order-number"},{"id":"MedicationRequest.groupIdentifier.value","path":"MedicationRequest.groupIdentifier.value","min":1},{"id":"MedicationRequest.courseOfTherapyType","path":"MedicationRequest.courseOfTherapyType","definition":"```json\r\n\"courseOfTherapyType\": {\r\n  \"coding\":  [\r\n      {\r\n          \"system\": \"http://terminology.hl7.org/CodeSystem/medicationrequest-course-of-therapy\",\r\n          \"code\": \"acute\",\r\n          \"display\": \"Short course (acute) therapy\"\r\n      }\r\n  ]\r\n},\r\n```","comment":"The type of prescription e.g. acute, continuous, etc. Was extension in STU3 https://fhir.hl7.org.uk/STU3/StructureDefinition/Extension-CareConnect-PrescriptionType-1 and Digital Medicine uses international codes, so continuous in place of repeat.","min":1,"mustSupport":true,"binding":{"strength":"required","valueSet":"https://fhir.nhs.uk/ValueSet/DM-medicationrequest-course-of-therapy"}},{"id":"MedicationRequest.courseOfTherapyType.coding","path":"MedicationRequest.courseOfTherapyType.coding","min":1,"max":"1"},{"id":"MedicationRequest.courseOfTherapyType.coding.system","path":"MedicationRequest.courseOfTherapyType.coding.system","min":1},{"id":"MedicationRequest.courseOfTherapyType.coding.code","path":"MedicationRequest.courseOfTherapyType.coding.code","min":1},{"id":"MedicationRequest.note","path":"MedicationRequest.note","short":"Dispensing Note","definition":"Clinical information relating to a prescribed medication item that cannot be conveyed within dosage instructions is populated within `note` field.\r\n\r\nExamples of dispensing notes are:\r\n\r\n- To explain changes in dosage, for example, “Dosage has been increased on advice of the hospital”.\r\n- \"Tell patient to stop their statin whilst on this anitbiotic\"\r\n- \"hospital consultant has confirmed dual treatment\"\r\n\r\nOne scenario where `note` must be populated is when the current prescribed medication item is the last authorised repeat of that medication within a repeat prescribing cycle. Appropriate text, such as “Last authorised repeat” must be included within the `note` to inform the dispenser and to allow the dispenser to communicate to the patient or patient representative. Note that for repeat dispensing, the ‘numberOfPrescriptionsIssued’ element also conveys this information.\r\n\r\n```json\r\n\"note\": [\r\n    {\r\n      \"text\": \"Tell patient to stop their statin whilst on this anitbiotic\"\r\n    }\r\n  ],\r\n```","mustSupport":true},{"id":"MedicationRequest.dosageInstruction","path":"MedicationRequest.dosageInstruction","definition":"The content of the `dosageInstruction` should follow guidance in [Dosage Structure Overview](https://developer.nhs.uk/apis/dose-syntax-implementation/dosage-overview.html). (Note this is based on CareConnect STU3 but the guidance is still valid in UKCore R4)\r\n\r\n`dosageInstruction.text` **MUST** be supplied and is a human readable version of the structured dose as would be printed on a paper prescription. The prescriber is required to enter a medication item dosage. The use of a generic default value, for example “Use as directed”, if a value is not entered, is not acceptable from a clinical perspective.\r\n\r\nThe prescriber is required to enter a medication item dosage. The use of a generic default value, for example “Use as directed”, if a value is not entered, is not acceptable from a clinical perspective. The user must be asked to select a dosage instruction from a pick list, type by hand or have the system populate with a valid and clinically safe dosage instruction relevant to the prescribed medication or clinical circumstances.\r\n\r\nAs per BNF guidelines, the dosage must be presented to the user without abbreviation although it may be entered and stored within the PMR in an abbreviated form. Within HL7 messaging, the dosage instruction must be represented without abbreviation.\r\n\r\n```json\r\n\"dosageInstruction\": [\r\n   {\r\n        \"text\": \"10 milligram, Inject, Subcutaneous route, once weekly\",\r\n        \"timing\": {\r\n            \"repeat\": {\r\n                \"boundsDuration\": {\r\n                    \"value\": 10,\r\n                    \"unit\": \"day\",\r\n                     \"system\": \"http://unitsofmeasure.org\",\r\n                     \"code\": \"d\"\r\n                },\r\n                 \"frequency\": 5,\r\n                 \"period\": 1,\r\n                \"periodUnit\": \"d\"\r\n             }\r\n        },\r\n        \"route\": {\r\n            \"coding\": [\r\n                {\r\n                    \"system\": \"http://snomed.info/sct\",\r\n                    \"code\": \"34206005\",\r\n                    \"display\": \"Subcutaneous route\"\r\n                }\r\n            ]\r\n        },\r\n        \"method\": {\r\n            \"coding\": [\r\n                {\r\n                    \"system\": \"http://snomed.info/sct\",\r\n                    \"code\": \"422145002\",\r\n                    \"display\": \"Inject\"\r\n                }\r\n            ]\r\n        },\r\n        \"doseAndRate\": [\r\n            {\r\n                \"doseQuantity\": {\r\n                    \"value\": 10,\r\n                    \"unit\": \"milligram\",\r\n                    \"system\": \"http://unitsofmeasure.org\",\r\n                    \"code\": \"mg\"\r\n                }\r\n            }\r\n        ]\r\n    }\r\n]\r\n\r\n```","min":1,"type":[{"code":"Dosage","profile":["https://fhir.nhs.uk/StructureDefinition/NHSDigital-Dosage"]}],"mustSupport":true},{"id":"MedicationRequest.dosageInstruction.additionalInstruction","path":"MedicationRequest.dosageInstruction.additionalInstruction","definition":"These sections **MUST** be used only be used to pass notes regarding the prescription to the pharmacist or patient. Lists of repeat medications and general practice notifications to the patient **SHOULD** be recorded in [NHSDigital-CommunicationRequest](https://simplifier.net/guide/nhsdigital/NHSDigital-CommunicationRequest) resource.\r\n\r\nPatient instructions for taking the drug are contained with in the `patientInstruction` and `additionalInstruction` as per the guidance in [Dosage Structure Overview](https://developer.nhs.uk/apis/dose-syntax-implementation/dosage-overview.html)\r\n\r\n```json\r\n\"dosageInstruction\": [\r\n    {\r\n        \"text\": \"10 milligram, Inject, Subcutaneous route, once weekly\",\r\n        \"additionalInstruction\": [\r\n            \"coding\": [\r\n                {\r\n                    \"system\": \"http://snomed.info/sct\",\r\n                    \"code\": \"421769005\",\r\n                    \"display\": \"Follow directions\"\r\n                }\r\n            ],\r\n        ],\r\n        \"patientInstruction\": \"As directed\"\r\n    }\r\n]\r\n```"},{"id":"MedicationRequest.dosageInstruction.patientInstruction","path":"MedicationRequest.dosageInstruction.patientInstruction","definition":"These sections **MUST** be used only be used to pass notes regarding the prescription to the pharmacist or patient. Lists of repeat medications and general practice notifications to the patient **SHOULD** be recorded in [NHSDigital-CommunicationRequest](https://simplifier.net/guide/nhsdigital/NHSDigital-CommunicationRequest) resource.\r\n\r\nPatient instructions for taking the drug are contained with in the `patientInstruction` and `additionalInstruction` as per the guidance in [Dosage Structure Overview](https://developer.nhs.uk/apis/dose-syntax-implementation/dosage-overview.html)\r\n\r\n```json\r\n\"dosageInstruction\": [\r\n    {\r\n        \"text\": \"10 milligram, Inject, Subcutaneous route, once weekly\",\r\n        \"additionalInstruction\": [\r\n            \"coding\": [\r\n                {\r\n                    \"system\": \"http://snomed.info/sct\",\r\n                    \"code\": \"421769005\",\r\n                    \"display\": \"Follow directions\"\r\n                }\r\n            ],\r\n        ],\r\n        \"patientInstruction\": \"As directed\"\r\n    }\r\n]\r\n```"},{"id":"MedicationRequest.dispenseRequest","path":"MedicationRequest.dispenseRequest","min":1,"mustSupport":true},{"id":"MedicationRequest.dispenseRequest.id","path":"MedicationRequest.dispenseRequest.id","max":"0"},{"id":"MedicationRequest.dispenseRequest.extension","path":"MedicationRequest.dispenseRequest.extension","slicing":{"discriminator":[{"type":"value","path":"url"}],"rules":"open"},"min":1},{"id":"MedicationRequest.dispenseRequest.extension:performerSiteType","path":"MedicationRequest.dispenseRequest.extension","sliceName":"performerSiteType","short":"type of dispensing organisation","min":1,"type":[{"code":"Extension","profile":["https://fhir.nhs.uk/StructureDefinition/Extension-DM-PerformerSiteType"]}],"mustSupport":true},{"id":"MedicationRequest.dispenseRequest.validityPeriod","path":"MedicationRequest.dispenseRequest.validityPeriod","definition":"The `validityPeriod` attribute defines the validity period for the prescription authorisation. This period must start (the `validityPeriod.start`) at the date of prescribing and cannot exceed 12 months (the `validityPeriod.end`). Typically, most repeatable prescriptions will be authorised for a validity period of either 6 or 12 months.\r\n\r\n```json\r\n\"dispenseRequest\": {\r\n          \"validityPeriod\": {\r\n            \"start\": \"2020-06-10\",\r\n            \"end\": \"2020-12-07\"\r\n          },\r\n          ...\r\n      }\r\n```","mustSupport":true},{"id":"MedicationRequest.dispenseRequest.validityPeriod.start","path":"MedicationRequest.dispenseRequest.validityPeriod.start","min":1},{"id":"MedicationRequest.dispenseRequest.numberOfRepeatsAllowed","path":"MedicationRequest.dispenseRequest.numberOfRepeatsAllowed","definition":"An integer indicating the number of times, in addition to the original dispense, (aka refills or repeats) that the patient can receive the prescribed medication. Usage Notes: This integer does not include the original order dispense. This means that if an order indicates dispense 30 tablets plus \"3 repeats\", then the order can be dispensed a total of 4 times and the patient can receive a total of 120 tablets. A prescriber may explicitly say that zero refills are permitted after the initial dispense. \r\n\r\nThe number of repeat issues authorised if specified. <br> <b>MUST</b> be present where a `continuous` or `continuous-repeat-dispensing` is authorised for a defined number of issues. <br> <b>MUST</b> NOT be specified where the number of repeat issues has not been defined. Therefore, the numberOfRepeats allowed is the total number of allowed issues. See also <a href=\"#repeatInformation\">extension repeatInformation</a>\r\n\r\nFor `continuous` orders and `continuous-repeat-dispensing` with intent=`reflex-order` (i.e., orders sent from EPS to pharmacists) this <b>MUST</b> be zero. The `numberOfRepeatsAllowed` in the extension to `basedOn` can be used to convey this information to inform patients that they need to re-order the medication.\r\n\r\nExample for a `continuous` issue:\r\n\r\n```json\r\n\r\n\"dispenseRequest\": {\r\n        \"numberOfRepeatsAllowed\": 0\r\n    }\r\n\r\n```\r\n\r\nExample for a `continuous-repeat-dispensing` issue with intent of `original-order`:\r\n\r\n```json\r\n\r\n\"dispenseRequest\": {\r\n        \"numberOfRepeatsAllowed\": 2\r\n    }\r\n```\r\n\r\nThis will result in a total of three issues of the medication.","mustSupport":true},{"id":"MedicationRequest.dispenseRequest.quantity","path":"MedicationRequest.dispenseRequest.quantity","min":1,"mustSupport":true},{"id":"MedicationRequest.dispenseRequest.quantity.value","path":"MedicationRequest.dispenseRequest.quantity.value","min":1},{"id":"MedicationRequest.dispenseRequest.quantity.unit","path":"MedicationRequest.dispenseRequest.quantity.unit","min":1},{"id":"MedicationRequest.dispenseRequest.quantity.code","path":"MedicationRequest.dispenseRequest.quantity.code","min":1},{"id":"MedicationRequest.dispenseRequest.expectedSupplyDuration","path":"MedicationRequest.dispenseRequest.expectedSupplyDuration","short":"Days Supply","definition":"The `expectedSupplyDuration` entity is required for repeat dispensing (repeatable) prescriptions only.\r\n\r\nThe `expectedSupplyDuration` element defines the expected duration, in days, of each issue of the prescription. A default value of 28 can be used which must be amendable by the prescriber when required. The value must be an integer value greater than zero. A sensible upper limit validation should be included within the System. If this value is omitted, the Spine will assume a value of 28.\r\n\r\n```json\r\n\"dispenseRequest\": {\r\n          ...\r\n          \"expectedSupplyDuration\": {\r\n            \"value\": 28,\r\n            \"unit\": \"days\",\r\n            \"system\": \"http://unitsofmeasure.org\",\r\n            \"code\": \"d\"\r\n          }\r\n      }\r\n```","mustSupport":true},{"id":"MedicationRequest.dispenseRequest.expectedSupplyDuration.value","path":"MedicationRequest.dispenseRequest.expectedSupplyDuration.value","min":1},{"id":"MedicationRequest.dispenseRequest.expectedSupplyDuration.code","path":"MedicationRequest.dispenseRequest.expectedSupplyDuration.code","min":1,"fixedCode":"d"},{"id":"MedicationRequest.dispenseRequest.performer","path":"MedicationRequest.dispenseRequest.performer","definition":"For non token based prescriptions the destination pharmacy **MUST** be recorded in the *dispenseRequest.performer.identifier* and a identifier reference (not a resource reference) with an ANANA/ODS Code **MUST** used. \r\n\r\nThe extension https://fhir.nhs.uk/StructureDefinition/Extension-DM-PerformerSiteType **MUST** be present.\r\n\r\nPatients pharmacy preferences may be sourced from PDS.\r\n\r\nPatients pharmacy preferences may be overriden by an 'one-off pharmacy nomination' by populating the *dispenseRequest.performer.identifier* with the ODS/ANANA code of the destination pharmacy.\r\n\r\n```json\r\n\"dispenseRequest\": {\r\n        \"extension\":  [\r\n            {\r\n                \"url\": \"https://fhir.nhs.uk/StructureDefinition/Extension-DM-PerformerSiteType\",\r\n                \"valueCoding\": {\r\n                    \"system\": \"https://fhir.nhs.uk/CodeSystem/dispensing-site-preference\",\r\n                    \"code\": \"0004\"\r\n                }\r\n            },\r\n        ],\r\n        \"performer\": {\r\n            \"identifier\": {\r\n                \"system\": \"https://fhir.nhs.uk/Id/ods-organization-code\",\r\n                \"value\": \"FX748\"\r\n            }\r\n        },\r\n```","type":[{"code":"Reference","targetProfile":["https://fhir.nhs.uk/StructureDefinition/NHSDigital-Organization-ODS"]}],"mustSupport":true},{"id":"MedicationRequest.dispenseRequest.performer.extension","path":"MedicationRequest.dispenseRequest.performer.extension","slicing":{"discriminator":[{"type":"value","path":"url"}],"rules":"open"},"min":0},{"id":"MedicationRequest.dispenseRequest.performer.extension:dispensingPractitioner","path":"MedicationRequest.dispenseRequest.performer.extension","sliceName":"dispensingPractitioner","short":"practitioner who released(/downloaded) the prescription","definition":"Details of the dispenser who is actioning the MedicationRequest\r\n\r\n```json\r\n       \"dispenseRequest\": { \r\n                    \"performer\": {\r\n                        \"extension\":  [\r\n                            {\r\n                                \"url\": \"https://fhir.nhs.uk/StructureDefinition/Extension-DM-DispensingPerformer\",\r\n                                \"valueReference\": {\r\n                                    \"reference\": \"urn:uuid:25f3dd9f-5838-44a7-930e-c78ae3ecadd6\",\r\n                                    \"display\": \"LOTTIE POTTS\"\r\n                                }\r\n                            }\r\n                        ],\r\n                        \"identifier\": {\r\n                            \"system\": \"https://fhir.nhs.uk/Id/ods-organization-code\",\r\n                            \"value\": \"VNE51\"\r\n                        },\r\n                        \"display\": \"The Simple Pharmacy\"\r\n                    }\r\n                },\r\n```","min":0,"max":"1","type":[{"code":"Extension","profile":["https://fhir.nhs.uk/StructureDefinition/Extension-DM-DispensingPerformer"]}],"mustSupport":true},{"id":"MedicationRequest.dispenseRequest.performer.identifier","path":"MedicationRequest.dispenseRequest.performer.identifier","min":1},{"id":"MedicationRequest.dispenseRequest.performer.identifier.system","path":"MedicationRequest.dispenseRequest.performer.identifier.system","min":1,"fixedUri":"https://fhir.nhs.uk/Id/ods-organization-code"},{"id":"MedicationRequest.dispenseRequest.performer.identifier.value","path":"MedicationRequest.dispenseRequest.performer.identifier.value","min":1},{"id":"MedicationRequest.substitution","path":"MedicationRequest.substitution","definition":"Within UK healthcare, substitution is not the norm and so this element will normally be set to a default of `false`.\r\n\r\nSubstitution being set to false is a mandatory requirement for EPS..\r\n\r\nSubstituition is a mandatory requirement for EPS.\r\n\r\n<div markdown=\"span\" class=\"alert alert-warning\" role=\"alert\"><i class=\"fa fa-information\"></i><h4>Important Note:</h4>\r\nWithin UK healthcare, substitution is not the norm so the international FHIR definition where \"_If nothing is specified substitution may be done._\" does not align with UK healthcare prescribing best practice.<br/>\r\n<p>It could be unwise to assume all UK implementations will prevent substitution if not explicitly stated, especially if the same clinical system has been previously implemented outside the UK. <br/></p>\r\n<p>UK Core has profiled this element as MANDATORY and MUST have a default boolean value of <code>false</code> to denote substitution is not allowed.</p>\r\n</div>\r\n<h3 id=\"allowing-substitution\">Allowing substitution</h3>\r\n<p>Where substitution to be be allowed, set to <code>true</code>. The inclusion of the coded reason is optional as the valueset defined in FHIR is of limited benefit to UK healthcare.</p>\r\n\r\n```json\r\n\r\n\"substitution\": {\r\n        \"allowedBoolean\": false\r\n    }\r\n\r\n```","mustSupport":true},{"id":"MedicationRequest.substitution.allowed[x]","path":"MedicationRequest.substitution.allowed[x]","type":[{"code":"boolean"}]},{"id":"MedicationRequest.eventHistory","path":"MedicationRequest.eventHistory","type":[{"code":"Reference","targetProfile":["https://fhir.nhs.uk/StructureDefinition/NHSDigital-Provenance"]}]}]}}